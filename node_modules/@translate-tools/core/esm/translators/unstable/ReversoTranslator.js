var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
import { BaseTranslator } from '../../util/BaseTranslator';
import { Multiplexor } from '../../lib/Multiplexor';
import { fetchResponseToJson } from '../../lib/fetchResponseToJson';
/**
 * This module did not test too ago
 */
var ReversoTranslator = /** @class */ (function (_super) {
    __extends(ReversoTranslator, _super);
    function ReversoTranslator() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.langMap = {
            en: 'eng',
            ar: 'ara',
            nl: 'dut',
            he: 'heb',
            es: 'spa',
            it: 'ita',
            zh: 'chi',
            de: 'ger',
            pl: 'pol',
            pt: 'por',
            ro: 'rum',
            ru: 'rus',
            tr: 'tur',
            fr: 'fra',
            ja: 'jpn',
        };
        _this.mtp = new Multiplexor({ tokenStart: '<', tokenEnd: '>' });
        return _this;
    }
    ReversoTranslator.isSupportedAutoFrom = function () {
        return false;
    };
    ReversoTranslator.getSupportedLanguages = function () {
        // eslint-disable
        // prettier-ignore
        return [
            'en', 'ar', 'nl', 'he', 'es', 'it', 'zh', 'de', 'pl', 'pt',
            'ro', 'ru', 'tr', 'fr', 'ja',
        ];
        // eslint-enable
    };
    ReversoTranslator.prototype.getLengthLimit = function () {
        return 5000;
    };
    ReversoTranslator.prototype.getRequestsTimeout = function () {
        return 1000;
    };
    ReversoTranslator.prototype.checkLimitExceeding = function (text) {
        if (Array.isArray(text)) {
            var encodedText = this.mtp.encode(text.map(function (text, id) { return ({ text: text, id: '' + id }); }));
            var extra = encodedText.length - this.getLengthLimit();
            return extra > 0 ? extra : 0;
        }
        else {
            var extra = text.length - this.getLengthLimit();
            return extra > 0 ? extra : 0;
        }
    };
    ReversoTranslator.prototype.translate = function (text, from, to) {
        var localFrom = this.langMap[from];
        var localTo = this.langMap[to];
        var data = {
            input: text,
            from: localFrom,
            to: localTo,
            format: 'text',
            options: {
                origin: 'reversodesktop',
                sentenceSplitter: true,
                contextResults: true,
                languageDetection: false,
            },
        };
        return fetch(this.wrapUrlToCorsProxy('https://api.reverso.net/translate/v1/translation'), {
            method: 'POST',
            headers: __assign({ 'Content-Type': 'application/json; charset=utf-8' }, this.options.headers),
            body: JSON.stringify(data),
        })
            .then(fetchResponseToJson)
            .then(function (response) {
            if (!(response instanceof Object) ||
                !(response.translation instanceof Array) ||
                response.translation.every(function (i) { return typeof i !== 'string'; })) {
                throw new Error('Unexpected response');
            }
            return response.translation.join('');
        });
    };
    ReversoTranslator.prototype.translateBatch = function (text, langFrom, langTo) {
        var _this = this;
        var encodedText = this.mtp.encode(text.map(function (text, id) { return ({ text: text, id: '' + id }); }));
        return this.translate(encodedText, langFrom, langTo).then(function (rawTranslate) {
            var result = Array(text.length);
            var decodedMap = _this.mtp.decode(rawTranslate);
            decodedMap.forEach(function (_a) {
                var id = _a.id, text = _a.text;
                var index = +id;
                result[index] = text;
            });
            return result;
        });
    };
    ReversoTranslator.translatorName = 'ReversoTranslator (public)';
    return ReversoTranslator;
}(BaseTranslator));
export { ReversoTranslator };

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zbGF0b3JzL3Vuc3RhYmxlL1JldmVyc29UcmFuc2xhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQzNELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUVwRTs7R0FFRztBQUNIO0lBQXVDLHFDQUFjO0lBQXJEO1FBQUEscUVBb0hDO1FBOUVRLGFBQU8sR0FBMkI7WUFDekMsRUFBRSxFQUFFLEtBQUs7WUFDVCxFQUFFLEVBQUUsS0FBSztZQUNULEVBQUUsRUFBRSxLQUFLO1lBQ1QsRUFBRSxFQUFFLEtBQUs7WUFDVCxFQUFFLEVBQUUsS0FBSztZQUNULEVBQUUsRUFBRSxLQUFLO1lBQ1QsRUFBRSxFQUFFLEtBQUs7WUFDVCxFQUFFLEVBQUUsS0FBSztZQUNULEVBQUUsRUFBRSxLQUFLO1lBQ1QsRUFBRSxFQUFFLEtBQUs7WUFDVCxFQUFFLEVBQUUsS0FBSztZQUNULEVBQUUsRUFBRSxLQUFLO1lBQ1QsRUFBRSxFQUFFLEtBQUs7WUFDVCxFQUFFLEVBQUUsS0FBSztZQUNULEVBQUUsRUFBRSxLQUFLO1NBQ1QsQ0FBQztRQTRDZSxTQUFHLEdBQUcsSUFBSSxXQUFXLENBQUMsRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDOztJQWtCNUUsQ0FBQztJQWpIYyxxQ0FBbUIsR0FBakM7UUFDQyxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFYSx1Q0FBcUIsR0FBbkM7UUFDQyxpQkFBaUI7UUFDakIsa0JBQWtCO1FBQ2xCLE9BQU87WUFDTixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUs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UUFmQSxJQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FDbEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksRUFBRSxFQUFFLElBQUssT0FBQSxDQUFDLEVBQUUsSUFBSSxNQUFBLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUF2QixDQUF1QixDQUFDLENBQy9DLENBQUM7UUFFRixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxZQUFZO1lBQ3RFLElBQU0sTUFBTSxHQUFHLEtBQUssQ0FBZ0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRWpELElBQU0sVUFBVSxHQUFHLEtBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ2pELFVBQVUsQ0FBQyxPQUFPLENBQUMsVUFBQyxFQUFZO29CQUFWLEVBQUUsUUFBQSxFQUFFLElBQUksVUFBQTtnQkFDN0IsSUFBTSxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ2xCLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDdEIsQ0FBQyxDQUFDLENBQUM7WUFFSCxPQUFPLE1BQU0sQ0FBQztRQUNmLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQWxIc0IsZ0NBQWMsR0FBRyw0QkFBNEIsQ0FBQztJQW1IdEUsd0JBQUM7Q0FwSEQsQUFvSEMsQ0FwSHNDLGNBQWMsR0FvSHBEO1NBcEhZLGlCQUFpQiIsImZpbGUiOiJ0cmFuc2xhdG9ycy91bnN0YWJsZS9SZXZlcnNvVHJhbnNsYXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGxhbmdDb2RlIH0gZnJvbSAnLi4vLi4vdHlwZXMvVHJhbnNsYXRvcic7XG5pbXBvcnQgeyBCYXNlVHJhbnNsYXRvciB9IGZyb20gJy4uLy4uL3V0aWwvQmFzZVRyYW5zbGF0b3InO1xuaW1wb3J0IHsgTXVsdGlwbGV4b3IgfSBmcm9tICcuLi8uLi9saWIvTXVsdGlwbGV4b3InO1xuaW1wb3J0IHsgZmV0Y2hSZXNwb25zZVRvSnNvbiB9IGZyb20gJy4uLy4uL2xpYi9mZXRjaFJlc3BvbnNlVG9Kc29uJztcblxuLyoqXG4gKiBUaGlzIG1vZHVsZSBkaWQgbm90IHRlc3QgdG9vIGFnb1xuICovXG5leHBvcnQgY2xhc3MgUmV2ZXJzb1RyYW5zbGF0b3IgZXh0ZW5kcyBCYXNlVHJhbnNsYXRvciB7XG5cdHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgdHJhbnNsYXRvck5hbWUgPSAnUmV2ZXJzb1RyYW5zbGF0b3IgKHB1YmxpYyknO1xuXG5cdHB1YmxpYyBzdGF0aWMgaXNTdXBwb3J0ZWRBdXRvRnJvbSgpIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRwdWJsaWMgc3RhdGljIGdldFN1cHBvcnRlZExhbmd1YWdlcygpOiBsYW5nQ29kZVtdIHtcblx0XHQvLyBlc2xpbnQtZGlzYWJsZVxuXHRcdC8vIHByZXR0aWVyLWlnbm9yZVxuXHRcdHJldHVybiBbXG5cdFx0XHQnZW4nLCAnYXInLCAnbmwnLCAnaGUnLCAnZXMnLCAnaXQnLCAnemgnLCAnZGUnLCAncGwnLCAncHQnLFxuXHRcdFx0J3JvJywgJ3J1JywgJ3RyJywgJ2ZyJywgJ2phJyxcblx0XHRdO1xuXHRcdC8vIGVzbGludC1lbmFibGVcblx0fVxuXG5cdHB1YmxpYyBnZXRMZW5ndGhMaW1pdCgpIHtcblx0XHRyZXR1cm4gNTAwMDtcblx0fVxuXG5cdHB1YmxpYyBnZXRSZXF1ZXN0c1RpbWVvdXQoKSB7XG5cdFx0cmV0dXJuIDEwMDA7XG5cdH1cblxuXHRwdWJsaWMgY2hlY2tMaW1pdEV4Y2VlZGluZyh0ZXh0OiBzdHJpbmcgfCBzdHJpbmdbXSkge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHRleHQpKSB7XG5cdFx0XHRjb25zdCBlbmNvZGVkVGV4dCA9IHRoaXMubXRwLmVuY29kZShcblx0XHRcdFx0dGV4dC5tYXAoKHRleHQsIGlkKSA9PiAoeyB0ZXh0LCBpZDogJycgKyBpZCB9KSksXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3QgZXh0cmEgPSBlbmNvZGVkVGV4dC5sZW5ndGggLSB0aGlzLmdldExlbmd0aExpbWl0KCk7XG5cdFx0XHRyZXR1cm4gZXh0cmEgPiAwID8gZXh0cmEgOiAwO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zdCBleHRyYSA9IHRleHQubGVuZ3RoIC0gdGhpcy5nZXRMZW5ndGhMaW1pdCgpO1xuXHRcdFx0cmV0dXJuIGV4dHJhID4gMCA/IGV4dHJhIDogMDtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGxhbmdNYXA6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG5cdFx0ZW46ICdlbmcnLFxuXHRcdGFyOiAnYXJhJyxcblx0XHRubDogJ2R1dCcsXG5cdFx0aGU6ICdoZWInLFxuXHRcdGVzOiAnc3BhJyxcblx0XHRpdDogJ2l0YScsXG5cdFx0emg6ICdjaGknLFxuXHRcdGRlOiAnZ2VyJyxcblx0XHRwbDogJ3BvbCcsXG5cdFx0cHQ6ICdwb3InLFxuXHRcdHJvOiAncnVtJyxcblx0XHRydTogJ3J1cycsXG5cdFx0dHI6ICd0dXInLFxuXHRcdGZyOiAnZnJhJyxcblx0XHRqYTogJ2pwbicsXG5cdH07XG5cblx0cHVibGljIHRyYW5zbGF0ZSh0ZXh0OiBzdHJpbmcsIGZyb206IGxhbmdDb2RlLCB0bzogbGFuZ0NvZGUpIHtcblx0XHRjb25zdCBsb2NhbEZyb20gPSB0aGlzLmxhbmdNYXBbZnJvbV07XG5cdFx0Y29uc3QgbG9jYWxUbyA9IHRoaXMubGFuZ01hcFt0b107XG5cblx0XHRjb25zdCBkYXRhID0ge1xuXHRcdFx0aW5wdXQ6IHRleHQsXG5cdFx0XHRmcm9tOiBsb2NhbEZyb20sXG5cdFx0XHR0bzogbG9jYWxUbyxcblx0XHRcdGZvcm1hdDogJ3RleHQnLFxuXHRcdFx0b3B0aW9uczoge1xuXHRcdFx0XHRvcmlnaW46ICdyZXZlcnNvZGVza3RvcCcsXG5cdFx0XHRcdHNlbnRlbmNlU3BsaXR0ZXI6IHRydWUsXG5cdFx0XHRcdGNvbnRleHRSZXN1bHRzOiB0cnVlLFxuXHRcdFx0XHRsYW5ndWFnZURldGVjdGlvbjogZmFsc2UsXG5cdFx0XHR9LFxuXHRcdH07XG5cblx0XHRyZXR1cm4gZmV0Y2goXG5cdFx0XHR0aGlzLndyYXBVcmxUb0NvcnNQcm94eSgnaHR0cHM6Ly9hcGkucmV2ZXJzby5uZXQvdHJhbnNsYXRlL3YxL3RyYW5zbGF0aW9uJyksXG5cdFx0XHR7XG5cdFx0XHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0XHRoZWFkZXJzOiB7XG5cdFx0XHRcdFx0J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Jyxcblx0XHRcdFx0XHQuLi50aGlzLm9wdGlvbnMuaGVhZGVycyxcblx0XHRcdFx0fSxcblx0XHRcdFx0Ym9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG5cdFx0XHR9LFxuXHRcdClcblx0XHRcdC50aGVuKGZldGNoUmVzcG9uc2VUb0pzb24pXG5cdFx0XHQudGhlbigocmVzcG9uc2UpID0+IHtcblx0XHRcdFx0aWYgKFxuXHRcdFx0XHRcdCEocmVzcG9uc2UgaW5zdGFuY2VvZiBPYmplY3QpIHx8XG5cdFx0XHRcdFx0IShyZXNwb25zZS50cmFuc2xhdGlvbiBpbnN0YW5jZW9mIEFycmF5KSB8fFxuXHRcdFx0XHRcdHJlc3BvbnNlLnRyYW5zbGF0aW9uLmV2ZXJ5KChpOiBhbnkpID0+IHR5cGVvZiBpICE9PSAnc3RyaW5nJylcblx0XHRcdFx0KSB7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIHJlc3BvbnNlJyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gKHJlc3BvbnNlLnRyYW5zbGF0aW9uIGFzIHN0cmluZ1tdKS5qb2luKCcnKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0cHJpdmF0ZSByZWFkb25seSBtdHAgPSBuZXcgTXVsdGlwbGV4b3IoeyB0b2tlblN0YXJ0OiAnPCcsIHRva2VuRW5kOiAnPicgfSk7XG5cdHB1YmxpYyB0cmFuc2xhdGVCYXRjaCh0ZXh0OiBzdHJpbmdbXSwgbGFuZ0Zyb206IGxhbmdDb2RlLCBsYW5nVG86IGxhbmdDb2RlKSB7XG5cdFx0Y29uc3QgZW5jb2RlZFRleHQgPSB0aGlzLm10cC5lbmNvZGUoXG5cdFx0XHR0ZXh0Lm1hcCgodGV4dCwgaWQpID0+ICh7IHRleHQsIGlkOiAnJyArIGlkIH0pKSxcblx0XHQpO1xuXG5cdFx0cmV0dXJuIHRoaXMudHJhbnNsYXRlKGVuY29kZWRUZXh0LCBsYW5nRnJvbSwgbGFuZ1RvKS50aGVuKChyYXdUcmFuc2xhdGUpID0+IHtcblx0XHRcdGNvbnN0IHJlc3VsdCA9IEFycmF5PHN0cmluZyB8IG51bGw+KHRleHQubGVuZ3RoKTtcblxuXHRcdFx0Y29uc3QgZGVjb2RlZE1hcCA9IHRoaXMubXRwLmRlY29kZShyYXdUcmFuc2xhdGUpO1xuXHRcdFx0ZGVjb2RlZE1hcC5mb3JFYWNoKCh7IGlkLCB0ZXh0IH0pID0+IHtcblx0XHRcdFx0Y29uc3QgaW5kZXggPSAraWQ7XG5cdFx0XHRcdHJlc3VsdFtpbmRleF0gPSB0ZXh0O1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fSk7XG5cdH1cbn1cbiJdfQ==
