var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
import { BaseTranslator } from '../../../util/BaseTranslator';
import { Multiplexor } from '../../../lib/Multiplexor';
import { fetchResponseToJson } from '../../../lib/fetchResponseToJson';
import { getConfig } from './getConfig';
/**
 * This translator is very slow for translate page, but may use to translate user input
 */
var BingTranslatorPublic = /** @class */ (function (_super) {
    __extends(BingTranslatorPublic, _super);
    function BingTranslatorPublic() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.mtp = new Multiplexor({ tokenStart: 'ðŸ˜€', tokenEnd: 'ðŸ˜ƒ' });
        return _this;
    }
    BingTranslatorPublic.isSupportedAutoFrom = function () {
        return true;
    };
    BingTranslatorPublic.getSupportedLanguages = function () {
        // eslint-disable
        // prettier-ignore
        return [
            'en', 'ar', 'af', 'bg', 'cy', 'hu', 'vi', 'el', 'da', 'he',
            'id', 'is', 'es', 'it', 'ca', 'ko', 'ht', 'lv', 'lt', 'mg',
            'ms', 'mt', 'de', 'nl', 'nb', 'fa', 'pl', 'pt', 'ro', 'ru',
            'sm', 'sk', 'sl', 'sw', 'ty', 'th', 'ta', 'te', 'to', 'tr',
            'uk', 'ur', 'fj', 'fi', 'fr', 'hi', 'hr', 'cs', 'sv', 'et',
            'ja',
        ];
        // eslint-enable
    };
    BingTranslatorPublic.prototype.getLengthLimit = function () {
        return 3000;
    };
    BingTranslatorPublic.prototype.getRequestsTimeout = function () {
        return 500;
    };
    BingTranslatorPublic.prototype.checkLimitExceeding = function (text) {
        if (Array.isArray(text)) {
            var encodedText = this.mtp.encode(text.map(function (text, id) { return ({ text: text, id: '' + id }); }));
            var extra = encodedText.length - this.getLengthLimit();
            return extra > 0 ? extra : 0;
        }
        else {
            var extra = text.length - this.getLengthLimit();
            return extra > 0 ? extra : 0;
        }
    };
    BingTranslatorPublic.prototype.encodeObject = function (obj) {
        return Object.keys(obj)
            .map(function (key) {
            return key + '=' + encodeURIComponent(obj[key]);
        })
            .join('&');
    };
    // This fn was copy from toolKit for independentcy
    BingTranslatorPublic.prototype.findInObj = function (obj, path, notFound) {
        if (notFound === void 0) { notFound = undefined; }
        try {
            return path.reduce(function (x, y) {
                if (y in x) {
                    return x[y];
                }
                else {
                    throw Error('Not found');
                }
            }, obj);
        }
        catch (e) {
            return notFound;
        }
    };
    BingTranslatorPublic.prototype.translate = function (text, from, to) {
        return __awaiter(this, void 0, void 0, function () {
            var fixedFrom, _a, IIG, IID, key, token;
            var _this = this;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        fixedFrom = from === 'auto' ? 'auto-detect' : from;
                        return [4 /*yield*/, getConfig()];
                    case 1:
                        _a = _b.sent(), IIG = _a.IIG, IID = _a.IID, key = _a.key, token = _a.token;
                        return [2 /*return*/, fetch(this.wrapUrlToCorsProxy("https://www.bing.com/ttranslatev3?isVertical=1&=&IG=".concat(IIG, "&=&IID=").concat(IID)), {
                                method: 'POST',
                                headers: __assign({ 'Content-type': 'application/x-www-form-urlencoded' }, this.options.headers),
                                body: '&' +
                                    this.encodeObject({
                                        fromLang: fixedFrom,
                                        to: to,
                                        text: text,
                                        token: token,
                                        key: key,
                                    }),
                            })
                                .then(fetchResponseToJson)
                                .then(function (rsp) {
                                var text = _this.findInObj(rsp, [0, 'translations', 0, 'text']);
                                if (typeof text === 'string') {
                                    return text;
                                }
                                else {
                                    if ('StatusCode' in rsp) {
                                        throw new Error("Unknown error. Code ".concat(rsp['StatusCode']));
                                    }
                                    else {
                                        throw new Error("Unknown error");
                                    }
                                }
                            })];
                }
            });
        });
    };
    BingTranslatorPublic.prototype.translateBatch = function (text, langFrom, langTo) {
        var _this = this;
        var encodedText = this.mtp.encode(text.map(function (text, id) { return ({ text: text, id: '' + id }); }));
        return this.translate(encodedText, langFrom, langTo).then(function (rawTranslate) {
            var result = Array(text.length);
            var decodedMap = _this.mtp.decode(rawTranslate);
            decodedMap.forEach(function (_a) {
                var id = _a.id, text = _a.text;
                var index = +id;
                result[index] = text;
            });
            return result;
        });
    };
    BingTranslatorPublic.translatorName = 'BingTranslator (public)';
    return BingTranslatorPublic;
}(BaseTranslator));
export { BingTranslatorPublic };

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zbGF0b3JzL3Vuc3RhYmxlL0JpbmdUcmFuc2xhdG9yUHVibGljL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQzlELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUV2RSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXhDOztHQUVHO0FBQ0g7SUFBMEMsd0NBQWM7SUFBeEQ7UUFBQSxxRUE0SEM7UUFsQmlCLFNBQUcsR0FBRyxJQUFJLFdBQVcsQ0FBQyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7O0lBa0I5RSxDQUFDO0lBekhjLHdDQUFtQixHQUFqQztRQUNDLE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVhLDBDQUFxQixHQUFuQztRQUNDLGlCQUFpQjtRQUNqQixrQkFBa0I7UUFDbEIsT0FBTztZQUNOLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDMUQsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtZQUMxRCxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO1lBQzFELElBQUksRUFB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QUMsRUFBdkIsQ0FBdUIsQ0FBQyxDQUMvQyxDQUFDO1FBRUYsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsWUFBWTtZQUN0RSxJQUFNLE1BQU0sR0FBRyxLQUFLLENBQWdCLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUVqRCxJQUFNLFVBQVUsR0FBRyxLQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNqRCxVQUFVLENBQUMsT0FBTyxDQUFDLFVBQUMsRUFBWTtvQkFBVixFQUFFLFFBQUEsRUFBRSxJQUFJLFVBQUE7Z0JBQzdCLElBQU0sS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNsQixNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDO1lBQ3RCLENBQUMsQ0FBQyxDQUFDO1lBRUgsT0FBTyxNQUFNLENBQUM7UUFDZixDQUFDLENBQUMsQ0FBQztJQUNKLENBQUM7SUExSHNCLG1DQUFjLEdBQUcseUJBQXlCLENBQUM7SUEySG5FLDJCQUFDO0NBNUhELEFBNEhDLENBNUh5QyxjQUFjLEdBNEh2RDtTQTVIWSxvQkFBb0IiLCJmaWxlIjoidHJhbnNsYXRvcnMvdW5zdGFibGUvQmluZ1RyYW5zbGF0b3JQdWJsaWMvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBsYW5nQ29kZSwgbGFuZ0NvZGVXaXRoQXV0byB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL1RyYW5zbGF0b3InO1xuaW1wb3J0IHsgQmFzZVRyYW5zbGF0b3IgfSBmcm9tICcuLi8uLi8uLi91dGlsL0Jhc2VUcmFuc2xhdG9yJztcbmltcG9ydCB7IE11bHRpcGxleG9yIH0gZnJvbSAnLi4vLi4vLi4vbGliL011bHRpcGxleG9yJztcbmltcG9ydCB7IGZldGNoUmVzcG9uc2VUb0pzb24gfSBmcm9tICcuLi8uLi8uLi9saWIvZmV0Y2hSZXNwb25zZVRvSnNvbic7XG5cbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4vZ2V0Q29uZmlnJztcblxuLyoqXG4gKiBUaGlzIHRyYW5zbGF0b3IgaXMgdmVyeSBzbG93IGZvciB0cmFuc2xhdGUgcGFnZSwgYnV0IG1heSB1c2UgdG8gdHJhbnNsYXRlIHVzZXIgaW5wdXRcbiAqL1xuZXhwb3J0IGNsYXNzIEJpbmdUcmFuc2xhdG9yUHVibGljIGV4dGVuZHMgQmFzZVRyYW5zbGF0b3Ige1xuXHRwdWJsaWMgc3RhdGljIHJlYWRvbmx5IHRyYW5zbGF0b3JOYW1lID0gJ0JpbmdUcmFuc2xhdG9yIChwdWJsaWMpJztcblxuXHRwdWJsaWMgc3RhdGljIGlzU3VwcG9ydGVkQXV0b0Zyb20oKSB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRwdWJsaWMgc3RhdGljIGdldFN1cHBvcnRlZExhbmd1YWdlcygpOiBsYW5nQ29kZVtdIHtcblx0XHQvLyBlc2xpbnQtZGlzYWJsZVxuXHRcdC8vIHByZXR0aWVyLWlnbm9yZVxuXHRcdHJldHVybiBbXG5cdFx0XHQnZW4nLCAnYXInLCAnYWYnLCAnYmcnLCAnY3knLCAnaHUnLCAndmknLCAnZWwnLCAnZGEnLCAnaGUnLFxuXHRcdFx0J2lkJywgJ2lzJywgJ2VzJywgJ2l0JywgJ2NhJywgJ2tvJywgJ2h0JywgJ2x2JywgJ2x0JywgJ21nJyxcblx0XHRcdCdtcycsICdtdCcsICdkZScsICdubCcsICduYicsICdmYScsICdwbCcsICdwdCcsICdybycsICdydScsXG5cdFx0XHQnc20nLCAnc2snLCAnc2wnLCAnc3cnLCAndHknLCAndGgnLCAndGEnLCAndGUnLCAndG8nLCAndHInLFxuXHRcdFx0J3VrJywgJ3VyJywgJ2ZqJywgJ2ZpJywgJ2ZyJywgJ2hpJywgJ2hyJywgJ2NzJywgJ3N2JywgJ2V0Jyxcblx0XHRcdCdqYScsXG5cdFx0XTtcblx0XHQvLyBlc2xpbnQtZW5hYmxlXG5cdH1cblxuXHRwdWJsaWMgZ2V0TGVuZ3RoTGltaXQoKSB7XG5cdFx0cmV0dXJuIDMwMDA7XG5cdH1cblxuXHRwdWJsaWMgZ2V0UmVxdWVzdHNUaW1lb3V0KCkge1xuXHRcdHJldHVybiA1MDA7XG5cdH1cblxuXHRwdWJsaWMgY2hlY2tMaW1pdEV4Y2VlZGluZyh0ZXh0OiBzdHJpbmcgfCBzdHJpbmdbXSkge1xuXHRcdGlmIChBcnJheS5pc0FycmF5KHRleHQpKSB7XG5cdFx0XHRjb25zdCBlbmNvZGVkVGV4dCA9IHRoaXMubXRwLmVuY29kZShcblx0XHRcdFx0dGV4dC5tYXAoKHRleHQsIGlkKSA9PiAoeyB0ZXh0LCBpZDogJycgKyBpZCB9KSksXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3QgZXh0cmEgPSBlbmNvZGVkVGV4dC5sZW5ndGggLSB0aGlzLmdldExlbmd0aExpbWl0KCk7XG5cdFx0XHRyZXR1cm4gZXh0cmEgPiAwID8gZXh0cmEgOiAwO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjb25zdCBleHRyYSA9IHRleHQubGVuZ3RoIC0gdGhpcy5nZXRMZW5ndGhMaW1pdCgpO1xuXHRcdFx0cmV0dXJuIGV4dHJhID4gMCA/IGV4dHJhIDogMDtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGVuY29kZU9iamVjdChvYmo6IFJlY29yZDxzdHJpbmcsIHN0cmluZyB8IG51bWJlcj4pIHtcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMob2JqKVxuXHRcdFx0Lm1hcCgoa2V5KSA9PiB7XG5cdFx0XHRcdHJldHVybiBrZXkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQob2JqW2tleV0pO1xuXHRcdFx0fSlcblx0XHRcdC5qb2luKCcmJyk7XG5cdH1cblxuXHQvLyBUaGlzIGZuIHdhcyBjb3B5IGZyb20gdG9vbEtpdCBmb3IgaW5kZXBlbmRlbnRjeVxuXHRwcml2YXRlIGZpbmRJbk9iaihvYmo6IGFueSwgcGF0aDogQXJyYXk8bnVtYmVyIHwgc3RyaW5nPiwgbm90Rm91bmQgPSB1bmRlZmluZWQpIHtcblx0XHR0cnkge1xuXHRcdFx0cmV0dXJuIHBhdGgucmVkdWNlKCh4LCB5KSA9PiB7XG5cdFx0XHRcdGlmICh5IGluIHgpIHtcblx0XHRcdFx0XHRyZXR1cm4geFt5XTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aHJvdyBFcnJvcignTm90IGZvdW5kJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIG9iaik7XG5cdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0cmV0dXJuIG5vdEZvdW5kO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyB0cmFuc2xhdGUodGV4dDogc3RyaW5nLCBmcm9tOiBsYW5nQ29kZVdpdGhBdXRvLCB0bzogbGFuZ0NvZGUpIHtcblx0XHRjb25zdCBmaXhlZEZyb20gPSBmcm9tID09PSAnYXV0bycgPyAnYXV0by1kZXRlY3QnIDogZnJvbTtcblxuXHRcdGNvbnN0IHsgSUlHLCBJSUQsIGtleSwgdG9rZW4gfSA9IGF3YWl0IGdldENvbmZpZygpO1xuXG5cdFx0cmV0dXJuIGZldGNoKFxuXHRcdFx0dGhpcy53cmFwVXJsVG9Db3JzUHJveHkoXG5cdFx0XHRcdGBodHRwczovL3d3dy5iaW5nLmNvbS90dHJhbnNsYXRldjM/aXNWZXJ0aWNhbD0xJj0mSUc9JHtJSUd9Jj0mSUlEPSR7SUlEfWAsXG5cdFx0XHQpLFxuXHRcdFx0e1xuXHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0aGVhZGVyczoge1xuXHRcdFx0XHRcdCdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcblx0XHRcdFx0XHQuLi50aGlzLm9wdGlvbnMuaGVhZGVycyxcblx0XHRcdFx0fSxcblx0XHRcdFx0Ym9keTpcblx0XHRcdFx0XHQnJicgK1xuXHRcdFx0XHRcdHRoaXMuZW5jb2RlT2JqZWN0KHtcblx0XHRcdFx0XHRcdGZyb21MYW5nOiBmaXhlZEZyb20sXG5cdFx0XHRcdFx0XHR0byxcblx0XHRcdFx0XHRcdHRleHQsXG5cdFx0XHRcdFx0XHR0b2tlbixcblx0XHRcdFx0XHRcdGtleSxcblx0XHRcdFx0XHR9KSxcblx0XHRcdH0sXG5cdFx0KVxuXHRcdFx0LnRoZW4oZmV0Y2hSZXNwb25zZVRvSnNvbilcblx0XHRcdC50aGVuKChyc3ApID0+IHtcblx0XHRcdFx0Y29uc3QgdGV4dCA9IHRoaXMuZmluZEluT2JqKHJzcCwgWzAsICd0cmFuc2xhdGlvbnMnLCAwLCAndGV4dCddKTtcblx0XHRcdFx0aWYgKHR5cGVvZiB0ZXh0ID09PSAnc3RyaW5nJykge1xuXHRcdFx0XHRcdHJldHVybiB0ZXh0O1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGlmICgnU3RhdHVzQ29kZScgaW4gcnNwKSB7XG5cdFx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gZXJyb3IuIENvZGUgJHtyc3BbJ1N0YXR1c0NvZGUnXX1gKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGVycm9yYCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0fVxuXG5cdHByaXZhdGUgcmVhZG9ubHkgbXRwID0gbmV3IE11bHRpcGxleG9yKHsgdG9rZW5TdGFydDogJ/CfmIAnLCB0b2tlbkVuZDogJ/CfmIMnIH0pO1xuXHRwdWJsaWMgdHJhbnNsYXRlQmF0Y2godGV4dDogc3RyaW5nW10sIGxhbmdGcm9tOiBsYW5nQ29kZVdpdGhBdXRvLCBsYW5nVG86IGxhbmdDb2RlKSB7XG5cdFx0Y29uc3QgZW5jb2RlZFRleHQgPSB0aGlzLm10cC5lbmNvZGUoXG5cdFx0XHR0ZXh0Lm1hcCgodGV4dCwgaWQpID0+ICh7IHRleHQsIGlkOiAnJyArIGlkIH0pKSxcblx0XHQpO1xuXG5cdFx0cmV0dXJuIHRoaXMudHJhbnNsYXRlKGVuY29kZWRUZXh0LCBsYW5nRnJvbSwgbGFuZ1RvKS50aGVuKChyYXdUcmFuc2xhdGUpID0+IHtcblx0XHRcdGNvbnN0IHJlc3VsdCA9IEFycmF5PHN0cmluZyB8IG51bGw+KHRleHQubGVuZ3RoKTtcblxuXHRcdFx0Y29uc3QgZGVjb2RlZE1hcCA9IHRoaXMubXRwLmRlY29kZShyYXdUcmFuc2xhdGUpO1xuXHRcdFx0ZGVjb2RlZE1hcC5mb3JFYWNoKCh7IGlkLCB0ZXh0IH0pID0+IHtcblx0XHRcdFx0Y29uc3QgaW5kZXggPSAraWQ7XG5cdFx0XHRcdHJlc3VsdFtpbmRleF0gPSB0ZXh0O1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fSk7XG5cdH1cbn1cbiJdfQ==
